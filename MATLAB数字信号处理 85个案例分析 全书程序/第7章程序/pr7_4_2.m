% 
% pr7_4_2  
clear all; clc; close all;

f0=49.13;                    % 基波频率
fs=3200;                     % 采样频率
N=2048;                      % 数据长度
n=0:N-1;                     % 数据索引
rad=pi/180;                  % 角度和弧度的转换因子
xb=[240,0.1,12,0.1,2.7,0.05,2.1,0,0.3,0,0.6]; % 谐波幅值
Q=[0,10,20,30,40,50,60,0,80,0,100]*rad;       % 谐波初始相位
t=n/fs;
M=11;
x=zeros(1,N);                % 初始化
for k=1 : M                  % 产生谐波信号
    x=x+xb(k)*cos(2*pi*f0*k*t+Q(k));
end

% 从pr7_4_1得到的参数Z
Z(:,1)=[2.7583e-6  -2.4827e-4  2.9546e-5  -1.2697e-4  -1.5198e-5  ...
    -4.1530e-6  1.3680e-6  1.7803e-8  -3.9620e-9];
Z(:,2)=[49.129997  98.259623  147.390008   196.520129  245.649998...
    294.779964  343.91  442.17  540.43];
Z(:,3)=[239.999981  0.100003  12.000005  0.099996  2.700002...
    0.049999  2.1  0.3  0.6];
Z(:,4)=[0  0.174767  0.349064  0.523684  0.698131  0.872657...
    1.047198  1.396263  1.745329];
% 重构拟合信号y
K=size(Z,1);
y=zeros(1,N);
for k=1 : K
   y=y+Z(k,3)*exp(Z(k,1)*t).*cos(2*pi*Z(k,2)*t+Z(k,4));
end
% 按式(7-4-15)计算信噪比
snr=prony_snr(x,y);
fprintf('SNR=%5.6f\n',snr);


